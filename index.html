<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tellurian Ritual Engine — Lullaby Re-Binding</title>
  <link rel="stylesheet" href="./styles.css?v=2" />
</head>
<body>
    <video id="bgVideo" autoplay muted loop playsinline>
    <source src="assets/video/root_loop.mp4" type="video/mp4">
  </video>
  <!-- Preload Wyvern Emergency Video (hidden) -->
<video
  id="wyvernPreload"
  preload="auto"
  muted
  playsinline
  style="display:none"
>
  <source src="assets/video/wyvern_emergency.mp4" type="video/mp4">
</video>
  
  <div id="app" class="app">

    <!-- TOP BAR -->
    <header class="topbar">
      <div class="brand">
        <div class="brand__title">The Lullaby of the Rootbound Heart</div>
        <div class="brand__subtitle">Tellurian Re-Binding Ritual Engine</div>
      </div>

      <div class="topControls">
        <button class="btn btn--ghost" id="btnSound">Enable Sound</button>
        <button class="btn btn--ghost" id="btnDock">DM Dock</button>
        <button class="btn" id="btnRollEvent">Roll Event</button>
        <button class="btn btn--primary" id="btnNextRound">Next Round</button>
      </div>
    </header>

    <!-- HUD STRIP -->
    <section class="hudStrip">
      <div class="hudBlock">
        <div class="hudLabel">Ritual Round</div>
        <div class="hudValue"><span id="roundNow">1</span>/<span id="roundMax">8</span></div>
        <div class="pips" id="roundPips" aria-hidden="true"></div>
      </div>

      <div class="hudBlock hudBlock--wide">
        <div class="hudLabel">Heartwood Event</div>
        <div class="hudValue hudValue--event" id="eventTitle">Root Stirring</div>
        <div class="hudHint" id="eventHint">Click “Roll Event”, then “Apply Event”.</div>
        <div class="hudMiniRow">
          <button class="btn btn--small" id="btnApplyEvent">Apply Event</button>
          <button class="btn btn--small btn--ghost" id="btnPrevEvent">◀</button>
          <button class="btn btn--small btn--ghost" id="btnNextEvent">▶</button>
        </div>
      </div>

      <div class="hudBlock">
        <div class="hudLabel">Pulse</div>
        <div class="hudValue" id="pulseLabel">Steady</div>
        <div class="hudHint" id="stateLabel">Binding in progress</div>
      </div>
    </section>

    <!-- MAIN STAGE -->
    <main class="stage stage--arena">

  <!-- RITUAL ARENA -->
  <section class="arena" aria-label="Ritual Arena">

    <div id="threatPanel" class="threatPanel hidden">
  <div class="threatName" id="threatName"></div>

  <div class="threatBar">
    <div class="threatHP" id="threatHP"></div>
  </div>

  <div class="threatHint" id="threatHint"></div>

  <div class="threatActions">
    <button class="btn btn--danger" onclick="damageThreat(15)">Strike Threat (15)</button>
    <button class="btn btn--ghost" onclick="damageThreat(30)">Heavy Blow (30)</button>
  </div>
</div>

    <!-- Center Heartwood -->
    <div class="arenaCenter">
      <div class="core core--arena">
        <div class="core__frame">
          <!-- Heartwood image is still via CSS ::before -->
          <svg class="heartwoodFX" viewBox="0 0 600 600" aria-hidden="true">
            <defs>
              <filter id="softGlow" x="-60%" y="-60%" width="220%" height="220%">
                <feGaussianBlur stdDeviation="7" result="b"/>
                <feMerge>
                  <feMergeNode in="b"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>

            <g filter="url(#softGlow)" opacity="0.95">
              <circle class="fxRing" cx="300" cy="300" r="230"/>
              <circle class="fxRing fxRing2" cx="300" cy="300" r="185"/>
              <circle class="fxRing fxRing3" cx="300" cy="300" r="135"/>
              <circle class="fxDot" cx="300" cy="300" r="14"/>

              <path class="fxRoot" d="M300 85 C 245 125, 215 165, 188 225 C 160 300, 178 352, 230 390"/>
              <path class="fxRoot" d="M300 85 C 355 125, 385 165, 412 225 C 440 300, 422 352, 370 390"/>
              <path class="fxRoot" d="M115 325 C 170 265, 218 230, 285 210 C 350 190, 408 208, 470 255"/>
              <path class="fxRoot" d="M485 305 C 430 360, 388 402, 328 420 C 268 438, 208 425, 165 392"/>
            </g>
          </svg>
        </div>
      </div>
    </div>

    <!-- Stone LEFT (Weight) -->
    <article class="stone stone--orbit stone--left" data-stone="weight">
      <div class="stoneOrbitTop">
        <div class="stoneName">Weight</div>
        <div class="pips pips--mini" id="prog_weight"></div>
      </div>
      <div class="stoneOrbitBody">
        <div class="stoneDisk stoneDisk--orbit" id="disk_weight" aria-hidden="true">
          <div class="cracks" id="crack_weight"></div>
        </div>
        <div class="stoneOrbitMeta">
          <div class="stressRow" id="stress_weight"></div>
          <div class="stoneActions stoneActions--orbit">
            <button class="btn btn--small" data-action="attempt" data-stone="weight">Attempt</button>
            <button class="btn btn--small btn--ghost" data-action="assist" data-stone="weight">Assist</button>
          </div>
        </div>
      </div>
    </article>

    <!-- Stone RIGHT (Memory) -->
    <article class="stone stone--orbit stone--right" data-stone="memory">
      <div class="stoneOrbitTop">
        <div class="stoneName">Memory</div>
        <div class="pips pips--mini" id="prog_memory"></div>
      </div>
      <div class="stoneOrbitBody">
        <div class="stoneDisk stoneDisk--orbit" id="disk_memory" aria-hidden="true">
          <div class="cracks" id="crack_memory"></div>
        </div>
        <div class="stoneOrbitMeta">
          <div class="stressRow" id="stress_memory"></div>
          <div class="chip chip--mini">Target <span id="memoryTarget">6</span></div>
          <div class="stoneActions stoneActions--orbit">
            <button class="btn btn--small" data-action="attempt" data-stone="memory">Attempt</button>
            <button class="btn btn--small btn--ghost" data-action="assist" data-stone="memory">Assist</button>
          </div>
        </div>
      </div>
    </article>

    <!-- Stone BOTTOM (Silence) -->
    <article class="stone stone--orbit stone--bottom" data-stone="silence">
      <div class="stoneOrbitTop">
        <div class="stoneName">Silence</div>
        <div class="pips pips--mini" id="prog_silence"></div>
      </div>
      <div class="stoneOrbitBody">
        <div class="stoneDisk stoneDisk--orbit" id="disk_silence" aria-hidden="true">
          <div class="cracks" id="crack_silence"></div>
        </div>
        <div class="stoneOrbitMeta">
          <div class="stressRow" id="stress_silence"></div>
          <div class="stoneActions stoneActions--orbit">
            <button class="btn btn--small" data-action="attempt" data-stone="silence">Attempt</button>
            <button class="btn btn--small btn--ghost" data-action="assist" data-stone="silence">Assist</button>
          </div>
        </div>
      </div>
    </article>

  </section>
</main>

<!-- Cinematic Ritual Banner (replaces the log panel) -->
<div id="banner" class="banner" aria-live="polite" aria-hidden="true">
  <div class="bannerInner">
    <div id="bannerKicker" class="bannerKicker">HEARTWOOD EVENT</div>
    <div id="bannerTitle" class="bannerTitle">Root Surge</div>
    <div id="bannerText" class="bannerText">Weight Stone +1 Stress (unless locked).</div>
  </div>
</div>


    <!-- MODAL -->
    <div id="modal" class="modal" aria-hidden="true" role="dialog">
      <div class="modalPanel">
        <div class="modalTitle" id="modalTitle">Attempt</div>
        <div class="modalBody" id="modalBody"></div>

        <div class="modalGrid">
          <div id="rollRow">
  <label class="field">
    <span class="fieldLabel">Roll Result</span>
    <input id="rollInput" class="input" type="number" inputmode="numeric" placeholder="Enter result" />
  </label>
</div>

          <label class="field" id="slotField" style="display:none;">
            <span class="fieldLabel">Slot Level</span>
            <input id="slotInput" class="input" type="number" inputmode="numeric" min="0" max="9" value="0" />
          </label>

          <label class="field" id="advField" style="display:none;">
            <span class="fieldLabel">Advantage?</span>
            <select id="advSelect" class="input">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </label>

          <label class="field" id="memoryAdjustField" style="display:none;">
            <span class="fieldLabel">Target Adjust (Assist)</span>
            <select id="memoryAdjust" class="input">
              <option value="0">0</option>
              <option value="-1">-1</option>
              <option value="1">+1</option>
            </select>
          </label>
        </div>

        <div class="modalActions">
          <button class="btn btn--ghost" id="btnCancel">Cancel</button>
          <button class="btn btn--primary" id="btnApply">Apply</button>
        </div>

        <div class="modalFoot" id="modalFoot"></div>
      </div>
    </div>

    <!-- DM DOCK -->
    <aside id="dmDock" class="dmDock" aria-hidden="true">
      <div class="dmDockHead">
        <div>
          <div class="dmDockTitle">DM Dock</div>
          <div class="dmDockSub">Overrides + quick control. (<kbd>`</kbd> to toggle)</div>
        </div>
        <button class="btn btn--small btn--ghost" id="btnDockClose">Close</button>
      </div>

      <div class="dmGrid">
        <div class="dmCard">
          <div class="dmCardTitle">Round</div>
          <div class="dmRow">
            <button class="btn btn--small btn--ghost" id="btnPrevRound">◀</button>
            <button class="btn btn--small" id="btnNextRoundDock">Next Round</button>
            <button class="btn btn--small btn--ghost" id="btnRollEventDock">Roll Event</button>
          </div>
        </div>

        <div class="dmCard">
          <div class="dmCardTitle">Stress</div>
          <div class="dmRow">
            <select id="stressStone" class="input input--small">
              <option value="weight">Weight</option>
              <option value="memory">Memory</option>
              <option value="silence">Silence</option>
            </select>
            <button class="btn btn--small" id="btnStressPlus">+ Stress</button>
            <button class="btn btn--small btn--ghost" id="btnStressMinus">- Stress</button>
          </div>
        </div>

        <div class="dmCard">
          <div class="dmCardTitle">Progress</div>
          <div class="dmRow">
            <select id="progStone" class="input input--small">
              <option value="weight">Weight</option>
              <option value="memory">Memory</option>
              <option value="silence">Silence</option>
            </select>
            <button class="btn btn--small" id="btnProgPlus">+ Progress</button>
            <button class="btn btn--small btn--ghost" id="btnProgMinus">- Progress</button>
          </div>
        </div>

        <div class="dmCard dmCard--wide">
          <div class="dmCardTitle">Utilities</div>
          <div class="dmRow">
            <button class="btn btn--small btn--ghost" id="btnReset">Reset Ritual</button>
          </div>
          <div class="dmNote">Audio plays only after “Enable Sound”.</div>
        </div>
      </div>
    </aside>

    <div id="toast" class="toast" aria-live="polite"></div>

  </div>

  <!-- Final Seal Overlay -->
<div id="sealOverlay" class="sealOverlay" aria-hidden="true">
  <div class="sealInner">
    <div class="sealKicker">THE FINAL SEAL</div>
    <div class="sealTitle">The Heartwood Sleeps</div>
    <div class="sealSub" id="sealSub">Roots draw inward. Stone remembers. Silence holds.</div>

    <div class="sealSigilWrap">
      <div class="sealSigilRing ringA"></div>
      <div class="sealSigilRing ringB"></div>
      <div class="sealSigilCore"></div>
    </div>

    <div class="sealFoot">Hold your breath. Let the earth close.</div>
  </div>
</div>

  
  <script src="ritual.js?v=3"></script>
  <!-- CINEMATIC OVERLAY (iframe player) -->
<div id="cinematicOverlay" class="cinOverlay" aria-hidden="true">
  <iframe
    id="cinematicFrame"
    class="cinFrame"
    title="Cinematic"
    allow="autoplay; fullscreen"
    allowfullscreen
  ></iframe>
</div>
</body>
</html>
